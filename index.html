<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NCAA Rosters</title>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>

<body>
    <script>
        "use strict"
        var osmURL = 'http://nominatim.openstreetmap.org/search/';
        var osmArgs = '?format=json&limit=1';

        d3.json(osmURL.concat('Fair Haven, NJ', osmArgs),
                function(e, d) {
                    console.log('lat: '+d[0].lat);
                    console.log('lon: '+d[0].lon);
                });

        var cities = {};
        var rosters = {};
        var roster_cnt = 0, len;

        function rate_limit

        function process_data(rosters) {
            console.log(rosters);
        }

        function load_roster(roster) {
            return;

            // This is clearly the most evil thing ever without some
            // rate limiting. Even with small batches of requests, I quickly
            // got blocked from making further requests. Need (1) some rate
            // limiting and (2) some caching of some sort. One possibly
            // useful strategy would be to do this in another language as
            // part of the pre-processing, and just ignore trying to do
            // it on the fly. I mean, it's not like the places will move, and
            // then we're back to loading my own files...
            d3.json('test-rosters/'.concat(roster), function(e, d) {
                var entry = {'name':d.name, 'color':d.color};
                d.hometowns.forEach(function(ht) {
                    if (ht == '--')
                        return;
                    if (cities[ht])
                        return;
                    d3.json(osmURL.concat(ht, osmArgs),
                            function(e, d) {
                            });
                });
                rosters[d.name] = entry;
                roster_cnt = roster_cnt + 1;
                if (cnt == len)
                    process_data(rosters);
            });
        }

        d3.html('test-rosters', function(e, d) {
            var lis = d3.select(d).selectAll('li a');
            len = lis[0].length;
            lis[0].forEach(function(r) {
                loadRoster(r['text']);
            });
        });

    </script>
<body>
</body>
</html>
